<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Task Pace Tracker</title>

<style>
:root{
  --bg:#f7f7f9;
  --card:#ffffff;
  --border:#e0e0e0;
}

body{
  font-family: system-ui, -apple-system;
  background:var(--bg);
  margin:0;
  padding:12px;
}

nav{
  display:flex;
  justify-content:space-around;
  margin-bottom:14px;
}
nav button{
  background:none;
  border:none;
  font-size:16px;
  padding:8px 14px;
  border-radius:10px;
}

.page{ display:none; }
.page.active{ display:block; }

input[type=number]{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:12px;
  border:1px solid var(--border);
  margin-bottom:16px;
}

/* HOME BARS */
.bars{
  display:flex;
  justify-content:space-evenly; /* FIXED spacing */
  gap:10px;
}

.barWrap{
  background:var(--card);
  padding:10px;
  border-radius:16px;
  width:90px;
  text-align:center;
  box-shadow:0 3px 10px rgba(0,0,0,0.06);
}

.container{
  height:200px;
  width:28px;
  margin:0 auto;
  background:#eee;
  border-radius:12px;
  overflow:hidden;
  display:flex;
  align-items:flex-end;
}

.bar{
  width:100%;
  transition:height 0.4s ease, background 0.4s ease;
}

.barLabel{
  margin-top:10px;
  font-weight:600;
  font-size:14px;
}

.barWrap button{
  margin-top:6px;
  border:none;
  background:#eee;
  padding:6px 10px;
  border-radius:10px;
}

/* MONTH TAB */
#monthHeader{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  margin-bottom:12px;
}

#calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:10px;
}

.day{
  border-radius:14px;
  padding:14px 8px;
  font-size:14px;
  text-align:center;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
  cursor:pointer;
}

.today{
  outline:2px solid #000;
}

/* POPUP */
#popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  align-items:center;
  justify-content:center;
}

#popupBox{
  background:var(--card);
  padding:18px;
  width:260px;
  border-radius:18px;
}

#popupBox button{
  width:100%;
  margin-top:10px;
  padding:12px;
  border:none;
  border-radius:12px;
  font-size:15px;
}
#popupBox button:first-of-type{
  background:#4CAF50;
  color:white;
}
#popupBox button:last-of-type{
  background:#eee;
}
</style>
</head>

<body>

<nav>
  <button onclick="showPage('home')">Home</button>
  <button onclick="showPage('month')">Monthly</button>
</nav>

<div id="home" class="page active">
  <input id="todayInput" type="number" placeholder="Minutes today" oninput="saveToday()">

  <div class="bars">

    <div class="barWrap">
      <div class="container"><div id="dayBar" class="bar"></div></div>
      <div id="dayLabel" class="barLabel"></div>
    </div>

    <div class="barWrap">
      <div class="container"><div id="weekBar" class="bar"></div></div>
      <div id="weekLabel" class="barLabel"></div>
      <button onclick="weekOffset--;updateAll()">‹</button>
      <button onclick="weekOffset++;updateAll()">›</button>
    </div>

    <div class="barWrap">
      <div class="container"><div id="monthBar" class="bar"></div></div>
      <div id="monthLabel" class="barLabel"></div>
      <button onclick="monthOffset--;updateAll()">‹</button>
      <button onclick="monthOffset++;updateAll()">›</button>
    </div>

  </div>
</div>

<div id="month" class="page">
  <div id="monthHeader">
    <button onclick="changeCalendar(-1)">‹</button>
    <strong id="monthTitle"></strong>
    <button onclick="changeCalendar(1)">›</button>
  </div>
  <div id="calendar"></div>
</div>

<div id="popup">
  <div id="popupBox">
    <div id="popupDate"></div>
    <input id="popupInput" type="number">
    <button onclick="savePopup()">Save</button>
    <button onclick="popup.style.display='none'">Cancel</button>
  </div>
</div>

<script>
var DAILY_TARGET = 600;
var weekOffset = 0;
var monthOffset = 0;
var calendarMonth = new Date();
var selectedKey = null;

/* IST SAFE DATE KEY */
function dateKey(d){
  return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}

/* STORAGE */
function loadData(){ return JSON.parse(localStorage.getItem("data")||"{}"); }
function saveData(d){ localStorage.setItem("data",JSON.stringify(d)); }

/* HEATMAP COLOR (RED → YELLOW → GREEN) */
function heatColor(ratio){
  ratio = Math.max(0, Math.min(ratio, 1));

  var r = 0, g = 0, b = 0;

  if (ratio < 0.25) {
    // Pure red -> orange
    var t = ratio / 0.25;
    r = 255;
    g = Math.floor(120 * t); // 0 → 120
  }
  else if (ratio < 0.5) {
    // Orange -> yellow
    var t = (ratio - 0.25) / 0.25;
    r = 255;
    g = Math.floor(120 + 135 * t); // 120 → 255
  }
  else if (ratio < 0.85) {
    // Yellow -> light green
    var t = (ratio - 0.5) / 0.35;
    r = Math.floor(255 * (1 - t)); // 255 → 0
    g = 255;
  }
  else {
    // Light green -> dark green (only near full)
    var t = (ratio - 0.85) / 0.15;
    r = 0;
    g = Math.floor(255 - 75 * t); // 255 → 180
  }

  return "rgb(" + r + "," + g + "," + b + ")";
}

/* PAGE */
function showPage(id){
  document.getElementById("home").classList.remove("active");
  document.getElementById("month").classList.remove("active");
  document.getElementById(id).classList.add("active");
  if(id==="month") buildCalendar();
}

/* HOME */
function saveToday(){
  var d=loadData();
  d[dateKey(new Date())]=Number(todayInput.value)||0;
  saveData(d);
  updateAll();
}

function pace(a,e){ return e<=0?0:Math.min(a/e,1); }

function setBar(bar,label,ratio,name){
  bar.style.height=(ratio*100)+"%";
  bar.style.background=heatColor(ratio);
  label.innerText=name+": "+Math.round(ratio*100)+"%";
}

function sumWeek(ref){
  var d=loadData(),sum=0,start=new Date(ref);
  start.setDate(ref.getDate()-ref.getDay());
  for(var i=0;i<7;i++){
    var x=new Date(start);x.setDate(start.getDate()+i);
    sum+=d[dateKey(x)]||0;
  }
  return sum;
}

function sumMonth(ref,limit){
  var d=loadData(),sum=0;
  var last=limit?new Date().getDate():new Date(ref.getFullYear(),ref.getMonth()+1,0).getDate();
  for(var i=1;i<=last;i++){
    sum+=d[dateKey(new Date(ref.getFullYear(),ref.getMonth(),i))]||0;
  }
  return sum;
}

function updateAll(){
  var now=new Date();
  var minutesToday=now.getHours()*60+now.getMinutes();
  var data=loadData();

  setBar(dayBar,dayLabel,
    pace(data[dateKey(now)]||0,(DAILY_TARGET/1440)*minutesToday),"Day");

  var wRef=new Date(now);wRef.setDate(wRef.getDate()+weekOffset*7);
  var wExp=weekOffset===0?(DAILY_TARGET/1440)*(minutesToday+now.getDay()*1440):DAILY_TARGET*7;
  setBar(weekBar,weekLabel,pace(sumWeek(wRef),wExp),"Week");

  var mRef=new Date(now);mRef.setMonth(mRef.getMonth()+monthOffset);
  var isCurrent=mRef.getMonth()===now.getMonth()&&mRef.getFullYear()===now.getFullYear();
  var mExp=isCurrent?(DAILY_TARGET/1440)*((now.getDate()-1)*1440+minutesToday):DAILY_TARGET*new Date(mRef.getFullYear(),mRef.getMonth()+1,0).getDate();
  setBar(monthBar,monthLabel,pace(sumMonth(mRef,isCurrent),mExp),"Month");
}

/* CALENDAR */
function buildCalendar(){
  var cal=document.getElementById("calendar");
  cal.innerHTML="";
  var d=loadData();
  monthTitle.innerText=calendarMonth.toLocaleString("default",{month:"long",year:"numeric"});
  var days=new Date(calendarMonth.getFullYear(),calendarMonth.getMonth()+1,0).getDate();

  for(var i=1;i<=days;i++){
    var date=new Date(calendarMonth.getFullYear(),calendarMonth.getMonth(),i);
    var key=dateKey(date);
    var mins=d[key]||0;
    var div=document.createElement("div");
    div.className="day";
    div.style.background=heatColor(mins/DAILY_TARGET);
    if(key===dateKey(new Date())) div.classList.add("today");
    div.innerHTML=i+"<br>"+mins+"m";
    div.onclick=function(k){
      return function(){
        selectedKey=k;
        popupDate.innerText=k;
        popupInput.value=d[k]||0;
        popup.style.display="flex";
      };
    }(key);
    cal.appendChild(div);
  }
}

function changeCalendar(o){
  calendarMonth.setMonth(calendarMonth.getMonth()+o);
  buildCalendar();
}

function savePopup(){
  var d=loadData();
  d[selectedKey]=Number(popupInput.value)||0;
  saveData(d);
  popup.style.display="none";
  updateAll();
  buildCalendar();
}

updateAll();
</script>

</body>
</html>
